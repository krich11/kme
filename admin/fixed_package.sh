#!/bin/bash
# SAE Package Self-Extractor
# Package: SAE TEST003A
# SAE ID: TEST003ABCDEFGHIJ
# Version: 1.0.0

# Embedded encrypted data
ENCRYPTED_DATA="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"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to print colored output
print_status() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

print_header() {
    echo -e "${BLUE}================================${NC}"
    echo -e "${BLUE}  SAE Package Self-Extractor${NC}"
    echo -e "${BLUE}================================${NC}"
    echo "Package: SAE TEST003A"
    echo "SAE ID: TEST003ABCDEFGHIJ"
    echo "Version: 1.0.0"
    echo ""
}

# Function to extract package
extract_package() {
    local password="$1"

    print_status "Extracting SAE package..."

    # Create .config directory
    local config_dir=".config"
    mkdir -p "$config_dir"

    # Decrypt and extract data
    print_status "Decrypting package data..."

    if ! echo "$ENCRYPTED_DATA" | base64 -d | \
        openssl enc -aes-256-cbc -d -salt -pbkdf2 \
            -pass "pass:$password" \
            -out "package.tar.gz" 2>/dev/null; then
        print_error "Invalid password or corrupted package"
        rm -f "package.tar.gz"
        return 1
    fi

    # Extract package contents
    print_status "Extracting package contents..."

    if ! tar -xzf package.tar.gz; then
        print_error "Failed to extract package contents"
        return 1
    fi

    # Remove temporary archive
    rm package.tar.gz

    # Set proper permissions for .config directory and files
    print_status "Setting file permissions..."
    chmod 700 .config
    chmod 600 .config/sae_private_key.pem
    chmod 644 .config/sae_certificate.pem
    chmod 644 .config/kme_ca_certificate.pem
    chmod 644 .config/sae_package.json
    chmod 755 *.sh *.py 2>/dev/null || true

    print_status "Package installed successfully!"
    echo ""
    echo "Files installed:"
    echo "Current directory:"
    ls -la *.sh *.py *.md 2>/dev/null || echo "  (no files)"
    echo ""
    echo ".config directory:"
    ls -la .config/

    echo ""
    print_status "Next steps:"
    echo "1. Review SECURITY_README.md"
    echo "2. Test connection: ./test_connection.sh"
    echo "3. Use client: python client_example.py"

    return 0
}

# Function to show help
show_help() {
    echo "Usage: $0 [password]"
    echo ""
    echo "Options:"
    echo "  password    Password to decrypt package (if not provided, will prompt)"
    echo "  --help      Show this help message"
    echo ""
    echo "The package will be extracted to .config/kme_sae/ in the current directory"
}

# Main execution
main() {
    print_header

    # Check for help
    if [[ "$1" == "--help" || "$1" == "-h" ]]; then
        show_help
        exit 0
    fi

    # Check if openssl is available
    if ! command -v openssl &> /dev/null; then
        print_error "OpenSSL is required but not installed"
        exit 1
    fi

    # Get password
    local password
    if [[ -n "$1" ]]; then
        password="$1"
    else
        read -s -p "Enter package password: " password
        echo
    fi

    # Extract package
    if extract_package "$password"; then
        print_status "Installation completed successfully!"
        exit 0
    else
        print_error "Installation failed!"
        exit 1
    fi
}

# Run main function
main "$@"
